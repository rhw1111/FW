(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-859a0a38"],{"1d47":function(e,t,a){"use strict";var n=a("f48d"),s=a.n(n);s.a},5954:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"TestCase"},[a("div",{staticClass:"q-pa-md"},[a("transition",{attrs:{name:"TreeEntity-slid"}},[a("el-tree",{directives:[{name:"show",rawName:"v-show",value:e.expanded,expression:"expanded"}],staticStyle:{"max-width":"20%",height:"600px",overflow:"auto",float:"left"},attrs:{data:e.simple,props:e.defaultProps,"highlight-current":!0,"expand-on-click-node":!1},on:{"node-expand":e.unfoldTree,"node-click":e.handleNodeClick}})],1),a("div",[a("q-btn",{staticStyle:{width:"2%",height:"600px",float:"left"},attrs:{color:"grey",flat:"",dense:"",icon:e.expanded?"keyboard_arrow_left":"keyboard_arrow_right"},on:{click:function(t){e.expanded=!e.expanded}}}),a("q-table",{attrs:{title:"测试用例列表",data:e.TestCaseList,columns:e.columns,"row-key":"id",selection:"multiple",selected:e.selected,"rows-per-page-options":[0],"table-style":"max-height: 500px;","no-data-label":"暂无数据更新"},on:{"update:selected":function(t){e.selected=t}},scopedSlots:e._u([{key:"top-right",fn:function(){return[a("q-btn",{staticClass:"btn",attrs:{color:"primary",label:"运 行"},on:{click:e.runTestCase}}),a("q-btn",{staticClass:"btn",attrs:{color:"primary",label:"新 增"},on:{click:e.openCrateTestCase}})]},proxy:!0},{key:"bottom",fn:function(){return[a("q-pagination",{staticClass:"col offset-md-10",attrs:{max:e.pagination.rowsNumber,input:!0},on:{input:e.nextPage},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})]},proxy:!0},{key:"body-cell-id",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("q-btn",{directives:[{name:"show",rawName:"v-show",value:"正在运行"==t.row.status,expression:"props.row.status=='正在运行'"}],staticClass:"btn",attrs:{color:"primary",label:"查看主机日志"},on:{click:function(a){return e.lookMasterLog(t)}}}),a("q-btn",{staticClass:"btn",attrs:{color:"primary",label:"更 新"},on:{click:function(a){return e.toDetail(t)}}}),a("q-btn",{staticClass:"btn",staticStyle:{background:"#FF0000",color:"white"},attrs:{label:"删 除"},on:{click:function(a){return e.deleteTestCase(t)}}})],1)]}}])})],1)],1),a("q-dialog",{attrs:{persistent:""},model:{value:e.createFixed,callback:function(t){e.createFixed=t},expression:"createFixed"}},[a("q-card",{staticStyle:{width:"100%","max-width":"70vw"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("创建测试用例")])]),a("q-separator"),a("CreateShowTestCase",{ref:"CSTestCase",attrs:{masterHostList:e.masterHostList}}),a("q-separator"),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"取消",color:"primary"},on:{click:e.newCancel}}),a("q-btn",{attrs:{flat:"",label:"创建",color:"primary"},on:{click:e.newCreate}})],1)],1)],1)],1)},s=[],i=(a("99af"),a("a15b"),a("b0c0"),a("53ca")),o=a("365c"),l=a("10b4"),r={name:"TestCase",components:{CreateShowTestCase:l["a"]},data:function(){return{createFixed:!1,TestCaseList:[],masterHostList:[],dataSourceName:[],selected:[],columns:[{name:"name",required:!0,label:"名称",align:"left",field:function(e){return e.name},format:function(e){return"".concat(e)}},{name:"engineType",align:"left",label:"引擎类型",field:"engineType",style:"max-width: 50px",headerStyle:"max-width: 50px"},{name:"configuration",label:"配置",align:"left",field:"configuration",style:"max-width: 250px",headerStyle:"max-width: 250px"},{name:"status",label:"状态",align:"left",field:"status"},{name:"id",label:"操作",align:"right",field:"id",headerStyle:"text-align:center"}],pagination:{page:1,rowsNumber:1},dismiss:null,expanded:!0,simple:[{id:null,label:"根目录",children:[]}],defaultProps:{children:"children",label:"label"},SelectLocation:""}},mounted:function(){this.getTestCaseList(),this.getTreeEntityList()},methods:{openCrateTestCase:function(){this.createFixed=!0},newCancel:function(){this.$refs.CSTestCase.newCancel(),this.createFixed=!1},newCreate:function(){var e=this;if(this.$refs.CSTestCase.newCreate()){var t=this.$refs.CSTestCase.newCreate();this.$q.loading.show(),o["K"](t).then((function(t){console.log(t),e.getTestCaseList(),e.$q.notify({position:"top",message:"提示",caption:"创建成功",color:"secondary"}),e.newCancel()}))}},getTestCaseList:function(e,t){var a=this;this.$q.loading.show();var n={parentId:t||null,matchName:"",page:e||1};o["z"](n).then((function(t){console.log(t),a.TestCaseList=t.data.results,a.pagination.page=e||1,a.pagination.rowsNumber=Math.ceil(t.data.totalCount/50),a.$q.loading.hide()}))},deleteTestCase:function(e){var t=this;console.log(e),this.$q.dialog({title:"提示",message:"您确定要删除当前的测试用例吗",persistent:!0,ok:{push:!0,label:"确定"},cancel:{push:!0,label:"取消"}}).onOk((function(){if(t.$q.loading.show(),null==e.row.treeID){var a="?id=".concat(e.row.id);o["f"](a).then((function(e){console.log(e),t.getTestCaseList()}))}else{var n="?id=".concat(e.row.treeID);o["j"](n).then((function(e){console.log(e),t.getTestCaseList()}))}}))},getMasterHostList:function(){var e=this;o["r"]().then((function(t){console.log(t),e.masterHostList=t.data,e.$q.loading.hide()}))},getSlaveHostsList:function(e,t){o["w"]({caseId:e}).then((function(e){0==e.data.length?t(!0):t(!1)}))},getDataSourceName:function(){var e=this,t={};o["l"](t).then((function(t){console.log(t),e.dataSourceName=t.data,e.$q.loading.hide()}))},nextPage:function(e){this.getTestCaseList(e,this.SelectLocation.id)},toDetail:function(e){this.$router.push({name:"TestCaseDetail",query:{id:e.row.id}})},runTestCase:function(){var e=this;if(0!=this.selected.length){var t=function(){for(var t=[],a=0;a<e.selected.length;a++)"正在运行"==e.selected[a].status&&t.push(e.selected[a].name);if(0!=t.length)return e.$q.notify({position:"top",message:"提示",caption:"当前测试用例".concat(t.join("，"),"正在运行当中,请重新选择"),color:"red"}),{v:void 0};e.$q.loading.show();for(var n=function(a){e.getSlaveHostsList(e.selected[a].id,(function(n){n&&t.push(e.selected[a].name),a==e.selected.length-1&&(0!=t.length?(e.$q.notify({position:"top",message:"提示",caption:"当前测试用例".concat(t.join("，"),"下没有从主机，请添加从主机再进行运行。"),color:"red"}),e.$q.loading.hide()):e.run(0))}))},s=0;s<e.selected.length;s++)n(s)}();if("object"===Object(i["a"])(t))return t.v}else this.$q.notify({position:"top",message:"提示",caption:"请选择测试用例",color:"red"})},run:function(e){var t=this;console.log(e),this.dismiss&&this.dismiss();var a=e;this.$q.loading.show();var n="?caseId=".concat(this.selected[a].id);o["Q"](n).then((function(e){console.log(e),t.dismiss=t.$q.notify({position:"top-right",caption:"当前测试用例".concat(t.selected[a].name,"正在运行当中。").concat(a+1,"/").concat(t.selected.length),color:"teal",timeout:"0"}),t.timerOut=window.setInterval((function(){setTimeout(t.getTestCaseStatus(a),0)}),3e3)}))},getTestCaseStatus:function(e){var t=this;o["A"]({caseId:this.selected[e].id}).then((function(a){if(!a.data){if(e==t.selected.length-1)return clearInterval(t.timerOut),t.timerOut=null,t.dismiss(),t.getMasterHostList(),void(t.selected=[]);clearInterval(t.timerOut),t.timerOut=null,setTimeout((function(){t.run(e+1)}),12e4)}}))},lookMasterLog:function(e){var t=this;this.$q.loading.show(),o["s"]({caseId:e.row.id}).then((function(e){t.$q.loading.hide(),t.$q.dialog({title:"提示",message:e.data,style:{width:"100%","max-width":"65vw","white-space":"pre-line","overflow-x":"hidden","word-break":"break-all"}})}))},getTreeEntityList:function(e,t){var a=this;this.$q.loading.show();var n={parentId:t||null,matchName:"",page:e||1,type:1,pageSize:100};o["F"](n).then((function(e){console.log(e);for(var t=0;t<e.data.results.length;t++)a.simple[0].children.push({id:e.data.results[t].id,label:e.data.results[t].name,parentID:e.data.results[t].parentID,type:e.data.results[t].type,value:e.data.results[t].value,children:[{}]});a.$q.loading.hide()}))},unfoldTree:function(e){var t=this;console.log(e),this.$q.loading.show();var a={parentId:e.id,matchName:"",page:1,type:1,pageSize:100};o["F"](a).then((function(a){console.log(a),e.children=[];for(var n=0;n<a.data.results.length;n++)e.children||t.$set(e,"children",[{}]),e.children.push({id:a.data.results[n].id,label:a.data.results[n].name,parentID:a.data.results[n].parentID,type:a.data.results[n].type,value:a.data.results[n].value,children:[{}]});t.$q.loading.hide()}))},handleNodeClick:function(e){console.log(e),this.getTestCaseList(1,e.id),this.SelectLocation=e}}},c=r,d=(a("b34d"),a("1d47"),a("2877")),u=Object(d["a"])(c,n,s,!1,null,"349d13a6",null);t["default"]=u.exports},b34d:function(e,t,a){"use strict";var n=a("ee26"),s=a.n(n);s.a},ee26:function(e,t,a){},f48d:function(e,t,a){}}]);
//# sourceMappingURL=chunk-859a0a38.4760efdc.js.map